From 853492490aeaca6bdfe65f254528848c902793c8 Mon Sep 17 00:00:00 2001
Message-Id: <853492490aeaca6bdfe65f254528848c902793c8.1645488928.git.lorenzo@kernel.org>
In-Reply-To: <ed7bb3256b02db7ef7ceb495bb3dbdd70131f1fe.1645488928.git.lorenzo@kernel.org>
References: <ed7bb3256b02db7ef7ceb495bb3dbdd70131f1fe.1645488928.git.lorenzo@kernel.org>
From: Lorenzo Bianconi <lorenzo@kernel.org>
Date: Tue, 22 Feb 2022 01:15:10 +0100
Subject: [PATCH mac80211-next 3/3] mac80211: update bssid_indicator in
 ieee80211_assign_beacon

Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
---
 net/mac80211/cfg.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/net/mac80211/cfg.c b/net/mac80211/cfg.c
index b5f30a09b5e4..140dae8e2635 100644
--- a/net/mac80211/cfg.c
+++ b/net/mac80211/cfg.c
@@ -1081,6 +1081,9 @@ static int ieee80211_assign_beacon(struct ieee80211_sub_if_data *sdata,
 		new->mbssid_ies = (struct cfg80211_mbssid_elems *)pos;
 		pos += struct_size(new->mbssid_ies, elem, mbssid->cnt);
 		ieee80211_copy_mbssid_beacon(pos, new->mbssid_ies, mbssid);
+		/* update bssid_indicator */
+		sdata->vif.bss_conf.bssid_indicator =
+			ilog2(__roundup_pow_of_two(mbssid->cnt + 1));
 	}
 
 	if (csa) {
-- 
2.35.1

